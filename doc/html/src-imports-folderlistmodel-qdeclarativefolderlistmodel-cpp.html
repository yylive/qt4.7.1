<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Qt 4.7: qdeclarativefolderlistmodel.cpp Example File (src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp)</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<h1 class="title">qdeclarativefolderlistmodel.cpp Example File</h1>
<span class="small-subtitle">src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp</span>
<!-- $$$src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp-description -->
<div class="descr"> <a name="details"></a>
<pre class="highlightedCode brush: cpp"><span class="comment"> /****************************************************************************
 **
 ** Copyright (C) 2010 Nokia Corporation and/or its subsidiary(-ies).
 ** All rights reserved.
 ** Contact: Nokia Corporation (qt-info@nokia.com)
 **
 ** This file is part of the examples of the Qt Toolkit.
 **
 ** $QT_BEGIN_LICENSE:LGPL$
 ** Commercial Usage
 ** Licensees holding valid Qt Commercial licenses may use this file in
 ** accordance with the Qt Commercial License Agreement provided with the
 ** Software or, alternatively, in accordance with the terms contained in
 ** a written agreement between you and Nokia.
 **
 ** GNU Lesser General Public License Usage
 ** Alternatively, this file may be used under the terms of the GNU Lesser
 ** General Public License version 2.1 as published by the Free Software
 ** Foundation and appearing in the file LICENSE.LGPL included in the
 ** packaging of this file.  Please review the following information to
 ** ensure the GNU Lesser General Public License version 2.1 requirements
 ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
 **
 ** In addition, as a special exception, Nokia gives you certain additional
 ** rights.  These rights are described in the Nokia Qt LGPL Exception
 ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package.
 **
 ** GNU General Public License Usage
 ** Alternatively, this file may be used under the terms of the GNU
 ** General Public License version 3.0 as published by the Free Software
 ** Foundation and appearing in the file LICENSE.GPL included in the
 ** packaging of this file.  Please review the following information to
 ** ensure the GNU General Public License version 3.0 requirements will be
 ** met: http://www.gnu.org/copyleft/gpl.html.
 **
 ** If you have questions regarding the use of this file, please contact
 ** Nokia at qt-info@nokia.com.
 ** $QT_END_LICENSE$
 **
 ****************************************************************************/</span>

 #include &quot;qdeclarativefolderlistmodel.h&quot;
 #include &lt;QDirModel&gt;
 #include &lt;QDebug&gt;
 #include &lt;qdeclarativecontext.h&gt;

 #ifndef QT_NO_DIRMODEL

 class QDeclarativeFolderListModelPrivate
 {
 public:
     QDeclarativeFolderListModelPrivate()
         : sortField(QDeclarativeFolderListModel::Name), sortReversed(false), count(0) {
         nameFilters &lt;&lt; QLatin1String(&quot;*&quot;);
     }

     void updateSorting() {
         QDir::SortFlags flags = 0;
         switch(sortField) {
         case QDeclarativeFolderListModel::Unsorted:
             flags |= QDir::Unsorted;
             break;
         case QDeclarativeFolderListModel::Name:
             flags |= QDir::Name;
             break;
         case QDeclarativeFolderListModel::Time:
             flags |= QDir::Time;
             break;
         case QDeclarativeFolderListModel::Size:
             flags |= QDir::Size;
             break;
         case QDeclarativeFolderListModel::Type:
             flags |= QDir::Type;
             break;
         }

         if (sortReversed)
             flags |= QDir::Reversed;

         model.setSorting(flags);
     }

     QDirModel model;
     QUrl folder;
     QStringList nameFilters;
     QModelIndex folderIndex;
     QDeclarativeFolderListModel::SortField sortField;
     bool sortReversed;
     int count;
 };

<span class="comment"> /*!
     \qmlclass FolderListModel QDeclarativeFolderListModel
     \ingroup qml-working-with-data
     \brief The FolderListModel provides a model of the contents of a file system folder.

     FolderListModel provides access to information about the contents of a folder
     in the local file system, exposing a list of files to views and other data components.

     \note This type is made available by importing the \c Qt.labs.folderlistmodel module.
     \e{Elements in the Qt.labs module are not guaranteed to remain compatible
     in future versions.}

     \bold{import Qt.labs.folderlistmodel 1.0}

     The \l folder property specifies the folder to access. Information about the
     files and directories in the folder is supplied via the model's interface.
     Components access names and paths via the following roles:

     \list
     \o fileName
     \o filePath
     \endlist

     Additionally a file entry can be differentiated from a folder entry via the
     isFolder() method.

     \section1 Filtering

     Various properties can be set to filter the number of files and directories
     exposed by the model.

     The \l nameFilters property can be set to contain a list of wildcard filters
     that are applied to names of files and directories, causing only those that
     match the filters to be exposed.

     Directories can be included or excluded using the \l showDirs property, and
     navigation directories can also be excluded by setting the \l showDotAndDotDot
     property to false.

     It is sometimes useful to limit the files and directories exposed to those
     that the user can access. The \l showOnlyReadable property can be set to
     enable this feature.

     \section1 Example Usage

     The following example shows a FolderListModel being used to provide a list
     of QML files in a \l ListView:

     \snippet doc/src/snippets/declarative/folderlistmodel.qml 0

     \section1 Path Separators

     Qt uses &quot;/&quot; as a universal directory separator in the same way that &quot;/&quot; is
     used as a path separator in URLs. If you always use &quot;/&quot; as a directory
     separator, Qt will translate your paths to conform to the underlying
     operating system.

     \sa {QML Data Models}
 */</span>

 QDeclarativeFolderListModel::QDeclarativeFolderListModel(QObject *parent)
     : QAbstractListModel(parent)
 {
     QHash&lt;int, QByteArray&gt; roles;
     roles[FileNameRole] = &quot;fileName&quot;;
     roles[FilePathRole] = &quot;filePath&quot;;
     setRoleNames(roles);

     d = new QDeclarativeFolderListModelPrivate;
     d-&gt;model.setFilter(QDir::AllDirs | QDir::Files | QDir::Drives | QDir::NoDotAndDotDot);
     connect(&amp;d-&gt;model, SIGNAL(rowsInserted(const QModelIndex&amp;,int,int))
             , this, SLOT(inserted(const QModelIndex&amp;,int,int)));
     connect(&amp;d-&gt;model, SIGNAL(rowsRemoved(const QModelIndex&amp;,int,int))
             , this, SLOT(removed(const QModelIndex&amp;,int,int)));
     connect(&amp;d-&gt;model, SIGNAL(dataChanged(const QModelIndex&amp;,const QModelIndex&amp;))
             , this, SLOT(handleDataChanged(const QModelIndex&amp;,const QModelIndex&amp;)));
     connect(&amp;d-&gt;model, SIGNAL(modelReset()), this, SLOT(refresh()));
     connect(&amp;d-&gt;model, SIGNAL(layoutChanged()), this, SLOT(refresh()));
 }

 QDeclarativeFolderListModel::~QDeclarativeFolderListModel()
 {
     delete d;
 }

 QVariant QDeclarativeFolderListModel::data(const QModelIndex &amp;index, int role) const
 {
     QVariant rv;
     QModelIndex modelIndex = d-&gt;model.index(index.row(), 0, d-&gt;folderIndex);
     if (modelIndex.isValid()) {
         if (role == FileNameRole)
             rv = d-&gt;model.data(modelIndex, QDirModel::FileNameRole).toString();
         else if (role == FilePathRole)
             rv = QUrl::fromLocalFile(d-&gt;model.data(modelIndex, QDirModel::FilePathRole).toString());
     }
     return rv;
 }

 int QDeclarativeFolderListModel::rowCount(const QModelIndex &amp;parent) const
 {
     Q_UNUSED(parent);
     return d-&gt;count;
 }

<span class="comment"> /*!
     \qmlproperty string FolderListModel::folder

     The \a folder property holds a URL for the folder that the model is
     currently providing.

     The value is a URL expressed as a string, and must be a \c file: or \c qrc:
     URL, or a relative URL.

     By default, the value is an invalid URL.
 */</span>
 QUrl QDeclarativeFolderListModel::folder() const
 {
     return d-&gt;folder;
 }

 void QDeclarativeFolderListModel::setFolder(const QUrl &amp;folder)
 {
     if (folder == d-&gt;folder)
         return;
     QModelIndex index = d-&gt;model.index(folder.toLocalFile());
     if ((index.isValid() &amp;&amp; d-&gt;model.isDir(index)) || folder.toLocalFile().isEmpty()) {

         d-&gt;folder = folder;
         QMetaObject::invokeMethod(this, &quot;refresh&quot;, Qt::QueuedConnection);
         emit folderChanged();
     }
 }

 QUrl QDeclarativeFolderListModel::parentFolder() const
 {
     QString localFile = d-&gt;folder.toLocalFile();
     if (!localFile.isEmpty()) {
         QDir dir(localFile);
 #if defined(Q_OS_SYMBIAN) || defined(Q_OS_WIN)
         if (dir.isRoot())
             dir.setPath(&quot;&quot;);
         else
 #endif
             dir.cdUp();
         localFile = dir.path();
     } else {
         int pos = d-&gt;folder.path().lastIndexOf(QLatin1Char('/'));
         if (pos == -1)
             return QUrl();
         localFile = d-&gt;folder.path().left(pos);
     }
     return QUrl::fromLocalFile(localFile);
 }

<span class="comment"> /*!
     \qmlproperty list&lt;string&gt; FolderListModel::nameFilters

     The \a nameFilters property contains a list of file name filters.
     The filters may include the ? and * wildcards.

     The example below filters on PNG and JPEG files:

     \qml
     FolderListModel {
         nameFilters: [ &quot;*.png&quot;, &quot;*.jpg&quot; ]
     }
     \endqml

     \note Directories are not excluded by filters.
 */</span>
 QStringList QDeclarativeFolderListModel::nameFilters() const
 {
     return d-&gt;nameFilters;
 }

 void QDeclarativeFolderListModel::setNameFilters(const QStringList &amp;filters)
 {
     d-&gt;nameFilters = filters;
     d-&gt;model.setNameFilters(d-&gt;nameFilters);
 }

 void QDeclarativeFolderListModel::classBegin()
 {
 }

 void QDeclarativeFolderListModel::componentComplete()
 {
     if (!d-&gt;folder.isValid() || !QDir().exists(d-&gt;folder.toLocalFile()))
         setFolder(QUrl(QLatin1String(&quot;file://&quot;)+QDir::currentPath()));

     if (!d-&gt;folderIndex.isValid())
         QMetaObject::invokeMethod(this, &quot;refresh&quot;, Qt::QueuedConnection);
 }

 QDeclarativeFolderListModel::SortField QDeclarativeFolderListModel::sortField() const
 {
     return d-&gt;sortField;
 }

 void QDeclarativeFolderListModel::setSortField(SortField field)
 {
     if (field != d-&gt;sortField) {
         d-&gt;sortField = field;
         d-&gt;updateSorting();
     }
 }

 bool QDeclarativeFolderListModel::sortReversed() const
 {
     return d-&gt;sortReversed;
 }

 void QDeclarativeFolderListModel::setSortReversed(bool rev)
 {
     if (rev != d-&gt;sortReversed) {
         d-&gt;sortReversed = rev;
         d-&gt;updateSorting();
     }
 }

<span class="comment"> /*!
     \qmlmethod bool FolderListModel::isFolder(int index)

     Returns true if the entry \a index is a folder; otherwise
     returns false.
 */</span>
 bool QDeclarativeFolderListModel::isFolder(int index) const
 {
     if (index != -1) {
         QModelIndex idx = d-&gt;model.index(index, 0, d-&gt;folderIndex);
         if (idx.isValid())
             return d-&gt;model.isDir(idx);
     }
     return false;
 }

 void QDeclarativeFolderListModel::refresh()
 {
     d-&gt;folderIndex = QModelIndex();
     if (d-&gt;count) {
         emit beginRemoveRows(QModelIndex(), 0, d-&gt;count);
         d-&gt;count = 0;
         emit endRemoveRows();
     }
     d-&gt;folderIndex = d-&gt;model.index(d-&gt;folder.toLocalFile());
     int newcount = d-&gt;model.rowCount(d-&gt;folderIndex);
     if (newcount) {
         emit beginInsertRows(QModelIndex(), 0, newcount-1);
         d-&gt;count = newcount;
         emit endInsertRows();
     }
 }

 void QDeclarativeFolderListModel::inserted(const QModelIndex &amp;index, int start, int end)
 {
     if (index == d-&gt;folderIndex) {
         emit beginInsertRows(QModelIndex(), start, end);
         d-&gt;count = d-&gt;model.rowCount(d-&gt;folderIndex);
         emit endInsertRows();
     }
 }

 void QDeclarativeFolderListModel::removed(const QModelIndex &amp;index, int start, int end)
 {
     if (index == d-&gt;folderIndex) {
         emit beginRemoveRows(QModelIndex(), start, end);
         d-&gt;count = d-&gt;model.rowCount(d-&gt;folderIndex);
         emit endRemoveRows();
     }
 }

 void QDeclarativeFolderListModel::handleDataChanged(const QModelIndex &amp;start, const QModelIndex &amp;end)
 {
     if (start.parent() == d-&gt;folderIndex)
         emit dataChanged(index(start.row(),0), index(end.row(),0));
 }

<span class="comment"> /*!
     \qmlproperty bool FolderListModel::showDirs

     If true, directories are included in the model; otherwise only files
     are included.

     By default, this property is true.

     Note that the nameFilters are not applied to directories.

     \sa showDotAndDotDot
 */</span>
 bool QDeclarativeFolderListModel::showDirs() const
 {
     return d-&gt;model.filter() &amp; QDir::AllDirs;
 }

 void  QDeclarativeFolderListModel::setShowDirs(bool on)
 {
     if (!(d-&gt;model.filter() &amp; QDir::AllDirs) == !on)
         return;
     if (on)
         d-&gt;model.setFilter(d-&gt;model.filter() | QDir::AllDirs | QDir::Drives);
     else
         d-&gt;model.setFilter(d-&gt;model.filter() &amp; ~(QDir::AllDirs | QDir::Drives));
 }

<span class="comment"> /*!
     \qmlproperty bool FolderListModel::showDotAndDotDot

     If true, the &quot;.&quot; and &quot;..&quot; directories are included in the model; otherwise
     they are excluded.

     By default, this property is false.

     \sa showDirs
 */</span>
 bool QDeclarativeFolderListModel::showDotAndDotDot() const
 {
     return !(d-&gt;model.filter() &amp; QDir::NoDotAndDotDot);
 }

 void  QDeclarativeFolderListModel::setShowDotAndDotDot(bool on)
 {
     if (!(d-&gt;model.filter() &amp; QDir::NoDotAndDotDot) == on)
         return;
     if (on)
         d-&gt;model.setFilter(d-&gt;model.filter() &amp; ~QDir::NoDotAndDotDot);
     else
         d-&gt;model.setFilter(d-&gt;model.filter() | QDir::NoDotAndDotDot);
 }

<span class="comment"> /*!
     \qmlproperty bool FolderListModel::showOnlyReadable

     If true, only readable files and directories are shown; otherwise all files
     and directories are shown.

     By default, this property is false.

     \sa showDirs
 */</span>
 bool QDeclarativeFolderListModel::showOnlyReadable() const
 {
     return d-&gt;model.filter() &amp; QDir::Readable;
 }

 void QDeclarativeFolderListModel::setShowOnlyReadable(bool on)
 {
     if (!(d-&gt;model.filter() &amp; QDir::Readable) == !on)
         return;
     if (on)
         d-&gt;model.setFilter(d-&gt;model.filter() | QDir::Readable);
     else
         d-&gt;model.setFilter(d-&gt;model.filter() &amp; ~QDir::Readable);
 }


 #endif <span class="comment">// QT_NO_DIRMODEL</span></pre>
</div>
<!-- @@@src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
