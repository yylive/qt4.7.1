<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- fetchmore.qdoc -->
  <title>Qt 4.7: Fetch More Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li>Fetch More Example</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#filelistmodel-class-definition">FileListModel Class Definition</a></li>
<li class="level1"><a href="#filelistmodel-class-implementation">FileListModel Class Implementation</a></li>
</ul>
</div>
<h1 class="title">Fetch More Example</h1>
<span class="subtitle"></span>
<!-- $$$itemviews/fetchmore-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="itemviews-fetchmore-filelistmodel-cpp.html">itemviews/fetchmore/filelistmodel.cpp</a></li>
<li><a href="itemviews-fetchmore-filelistmodel-h.html">itemviews/fetchmore/filelistmodel.h</a></li>
<li><a href="itemviews-fetchmore-window-cpp.html">itemviews/fetchmore/window.cpp</a></li>
<li><a href="itemviews-fetchmore-window-h.html">itemviews/fetchmore/window.h</a></li>
<li><a href="itemviews-fetchmore-main-cpp.html">itemviews/fetchmore/main.cpp</a></li>
<li><a href="itemviews-fetchmore-fetchmore-pro.html">itemviews/fetchmore/fetchmore.pro</a></li>
</ul>
<p>The Fetch More example shows how two add items to an item view model on demand.</p>
<p class="centerAlign"><img src="images/fetchmore-example.png" /></p><p>The user of the example can enter a directory in the <b>Directory</b> line edit. The contents of the directory will be listed in the list view below.</p>
<p>When you have large - or perhaps even infinite - data sets, you will need to add items to the model in batches, and preferably only when the items are needed by the view (i.e&#x2e;, when they are visible in the view).</p>
<p>In this example, we implement <tt>FileListModel</tt> - an item view model containing the entries of a directory. We also have <tt>Window</tt>, which sets up the GUI and feeds the model with directories.</p>
<p>Let's take a tour of <tt>FileListModel</tt>'s code.</p>
<a name="filelistmodel-class-definition"></a>
<h2>FileListModel Class Definition</h2>
<p>The <tt>FileListModel</tt> inherits <a href="qabstractlistmodel.html">QAbstractListModel</a> and contains the contents of a directory. It will add items to itself only when requested to do so by the view.</p>
<pre class="highlightedCode brush: cpp"> class FileListModel : public QAbstractListModel
 {
     Q_OBJECT

 public:
     FileListModel(QObject *parent = 0);

     int rowCount(const QModelIndex &amp;parent = QModelIndex()) const;
     QVariant data(const QModelIndex &amp;index, int role = Qt::DisplayRole) const;

 signals:
     void numberPopulated(int number);

 public slots:
     void setDirPath(const QString &amp;path);

 protected:
     bool canFetchMore(const QModelIndex &amp;parent) const;
     void fetchMore(const QModelIndex &amp;parent);

 private:
     QStringList fileList;
     int fileCount;
 };</pre>
<p>The secret lies in the reimplementation of <a href="qabstractitemmodel.html#fetchMore">fetchMore()</a> and <a href="qabstractitemmodel.html#canFetchMore">canFetchMore()</a> from <a href="qabstractitemmodel.html">QAbstractItemModel</a>. These functions are called by the item view when it needs more items.</p>
<p>The <tt>setDirPath()</tt> function sets the directory the model will work on. We emit <tt>numberPopulated()</tt> each time we add a batch of items to the model.</p>
<p>We keep all directory entries in <tt>fileList</tt>. <tt>fileCount</tt> is the number of items that have been added to the model.</p>
<a name="filelistmodel-class-implementation"></a>
<h2>FileListModel Class Implementation</h2>
<p>We start by checking out the <tt>setDirPath()</tt>.</p>
<pre class="highlightedCode brush: cpp"> void FileListModel::setDirPath(const QString &amp;path)
 {
     QDir dir(path);

     fileList = dir.entryList();
     fileCount = 0;
     reset();
 }</pre>
<p>We use a <a href="qdir.html">QDir</a> to get the contents of the directory. We need to inform <a href="qabstractitemmodel.html">QAbstractItemModel</a> that we want to remove all items - if any - from the model.</p>
<pre class="highlightedCode brush: cpp"> bool FileListModel::canFetchMore(const QModelIndex &amp; <span class="comment">/* index */</span>) const
 {
     if (fileCount &lt; fileList.size())
         return true;
     else
         return false;
 }</pre>
<p>The <tt>canFetchMore()</tt> function is called by the view when it needs more items. We return true if there still are entries that we have not added to the model; otherwise, we return false.</p>
<p>And now, the <tt>fetchMore()</tt> function itself:</p>
<pre class="highlightedCode brush: cpp"> void FileListModel::fetchMore(const QModelIndex &amp; <span class="comment">/* index */</span>)
 {
     int remainder = fileList.size() - fileCount;
     int itemsToFetch = qMin(100, remainder);

     beginInsertRows(QModelIndex(), fileCount, fileCount+itemsToFetch-1);

     fileCount += itemsToFetch;

     endInsertRows();

     emit numberPopulated(itemsToFetch);
 }</pre>
<p>We first calculate the number of items to fetch. <a href="qabstractitemmodel.html#beginInsertRows">beginInsertRows()</a> and <a href="qabstractitemmodel.html#endInsertRows">endInsertRows()</a> are mandatory for <a href="qabstractitemmodel.html">QAbstractItemModel</a> to keep up with the row insertions. Finally, we emit <tt>numberPopulated()</tt>, which is picked up by <tt>Window</tt>.</p>
<p>To complete the tour, we also look at <tt>rowCount()</tt> and <tt>data()</tt>.</p>
<pre class="highlightedCode brush: cpp"> int FileListModel::rowCount(const QModelIndex &amp; <span class="comment">/* parent */</span>) const
 {
     return fileCount;
 }

 QVariant FileListModel::data(const QModelIndex &amp;index, int role) const
 {
     if (!index.isValid())
         return QVariant();

     if (index.row() &gt;= fileList.size() || index.row() &lt; 0)
         return QVariant();

     if (role == Qt::DisplayRole)
         return fileList.at(index.row());
     else if (role == Qt::BackgroundRole) {
         int batch = (index.row() / 100) % 2;
         if (batch == 0)
             return qApp-&gt;palette().base();
         else
             return qApp-&gt;palette().alternateBase();
     }
     return QVariant();
 }</pre>
<p>Notice that the row count is only the items we have added so far, i.e&#x2e;, not the number of entries in the directory.</p>
<p>In <tt>data()</tt>, we return the appropriate entry from the <tt>fileList</tt>. We also separate the batches with a different background color.</p>
</div>
<!-- @@@itemviews/fetchmore -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
