<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- i18n.qdoc -->
  <title>Qt 4.7: Writing Source Code for Translation</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li>Writing Source Code for Translation</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
  <link rel="prev" href="internationalization.html" />
  <link rel="next" href="i18n-plural-rules.html" />
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#the-basics">The Basics</a></li>
<li class="level1"><a href="#defining-a-translation-context">Defining a Translation Context</a></li>
<li class="level1"><a href="#using-tr-to-obtain-a-translation">Using tr() to Obtain a Translation</a></li>
<li class="level1"><a href="#translator-comments">Translator Comments</a></li>
<li class="level1"><a href="#adding-meta-data-to-strings">Adding Meta-Data to Strings</a></li>
<li class="level1"><a href="#disambiguation">Disambiguation</a></li>
<li class="level1"><a href="#character-encodings">Character Encodings</a></li>
<li class="level1"><a href="#handling-plurals">Handling Plurals</a></li>
<li class="level1"><a href="#enabling-translation">Enabling Translation</a></li>
<li class="level1"><a href="#further-reading">Further Reading</a></li>
</ul>
</div>
<h1 class="title">Writing Source Code for Translation</h1>
<span class="subtitle"></span>
<!-- $$$i18n-source-translation.html-description -->
<div class="descr"> <a name="details"></a>
<a name="the-basics"></a>
<h2>The Basics</h2>
<p>Developers use the <a href="qobject.html#tr">tr()</a> function to obtain translated text for their classes, typically for display purposes. This function is also used to indicate which text strings in an application are translatable.</p>
<p>Qt indexes each translatable string by the <i>translation context</i> it is associated with; this is generally the name of the <a href="qobject.html">QObject</a> subclass it is used in.</p>
<p>Translation contexts are defined for new <a href="qobject.html">QObject</a>-based classes by the use of the <a href="qobject.html#Q_OBJECT">Q_OBJECT</a> macro in each new class definition.</p>
<p>When tr() is called, it looks up the translatable string using a <a href="qtranslator.html">QTranslator</a> object. For translation to work, one or more of these must have been installed on the application object in the way described in the <a href="#enabling-translation">Enabling Translation</a> section below.</p>
<a name="defining-a-translation-context"></a>
<h2>Defining a Translation Context</h2>
<p>The translation context for <a href="qobject.html">QObject</a> and each <a href="qobject.html">QObject</a> subclass is the class name itself. Developers subclassing <a href="qobject.html">QObject</a> must use the <a href="qobject.html#Q_OBJECT">Q_OBJECT</a> macro in their class definition to override the translation context. This macro sets the context to the name of the subclass.</p>
<p>For example, the following class definition includes the <a href="qobject.html#Q_OBJECT">Q_OBJECT</a> macro, implementing a new tr() that uses the <tt>MainWindow</tt> context:</p>
<pre class="highlightedCode brush: cpp"> class MainWindow : public QMainWindow
 {
     Q_OBJECT

 public:
     MainWindow();
     ...</pre>
<p>If <a href="qobject.html#Q_OBJECT">Q_OBJECT</a> is not used in a class definition, the context will be inherited from the base class. For example, since all <a href="qobject.html">QObject</a>-based classes in Qt provide a context, a new <a href="qwidget.html">QWidget</a> subclass defined without a <a href="qobject.html#Q_OBJECT">Q_OBJECT</a> macro will use the <tt>QWidget</tt> context if its tr() function is invoked.</p>
<a name="using-tr-to-obtain-a-translation"></a>
<h2>Using tr() to Obtain a Translation</h2>
<p>The following example shows how a translation is obtained for the class shown in the previous section:</p>
<pre class="highlightedCode brush: cpp"> void MainWindow::createMenus()
 {
     fileMenu = menuBar()-&gt;addMenu(tr(&quot;&amp;File&quot;));
     ...</pre>
<p>Here, the translation context is <tt>MainWindow</tt> because it is the <tt>MainWindow::tr()</tt> function that is invoked. The text returned by the tr() function is a translation of &quot;&amp;File&quot; obtained from the <tt>MainWindow</tt> context.</p>
<p>When Qt's translation tool, <a href="linguist-manager.html#lupdate">lupdate</a>, is used to process a set of source files, the text wrapped in tr() calls is stored in a section of the translation file that corresponds to its translation context.</p>
<p>In some situations, it is useful to give a translation context explicitly by fully qualifying the call to tr(); for example:</p>
<pre class="highlightedCode brush: cpp"> QString text = QScrollBar::tr(&quot;Page up&quot;);</pre>
<p>This call obtains the translated text for &quot;Page up&quot; from the <tt>QScrollBar</tt> context. Developers can also use the <a href="qcoreapplication.html#translate">QCoreApplication::translate</a>() function to obtain a translation for a particular translation context.</p>
<a name="translator-comments"></a>
<h2>Translator Comments</h2>
<p>Developers can include information about each translatable string to help translators with the translation process. These are extracted when <a href="linguist-manager.html#lupdate">lupdate</a> is used to process the source files. The recommended way to add comments is to annotate the tr() calls in your code with comments of the form:</p>
<p><tt>//: ..&#x2e;</tt></p>
<p>or</p>
<p><tt><tt>/*</tt>: ..&#x2e; <tt>*/</tt></tt></p>
<p>Examples:</p>
<pre class="highlightedCode brush: cpp"><span class="comment"> //: This name refers to a host name.</span>
 hostNameLabel-&gt;setText(tr(&quot;Name:&quot;));

<span class="comment"> /*: This text refers to a C++ code example. */</span>
 QString example = tr(&quot;Example&quot;);</pre>
<p>In these examples, the comments will be associated with the strings passed to tr() in the context of each call.</p>
<a name="adding-meta-data-to-strings"></a>
<h2>Adding Meta-Data to Strings</h2>
<p>Additional data can be attached to each translatable message. These are extracted when <a href="linguist-manager.html#lupdate">lupdate</a> is used to process the source files. The recommended way to add meta-data is to annotate the tr() calls in your code with comments of the form:</p>
<p><tt>//= &lt;id&gt;</tt></p>
<p>This can be used to give the message a unique identifier to support tools which need it.</p>
<p>An alternative way to attach meta-data is to use the following syntax:</p>
<p><tt>//~ &lt;field name&gt; &lt;field contents&gt;</tt></p>
<p>This can be used to attach meta-data to the message. The field name should consist of a domain prefix (possibly the conventional file extension of the file format the field is inspired by), a hyphen and the actual field name in underscore-delimited notation. For storage in TS files, the field name together with the prefix &quot;extra-&quot; will form an XML element name. The field contents will be XML-escaped, but otherwise appear verbatim as the element's contents. Any number of unique fields can be added to each message.</p>
<p>Example:</p>
<pre class="highlightedCode brush: cpp"><span class="comment"> //: This is a comment for the translator.</span>
<span class="comment"> //= qtn_foo_bar</span>
<span class="comment"> //~ loc-layout_id foo_dialog</span>
<span class="comment"> //~ loc-blank False</span>
<span class="comment"> //~ magic-stuff This might mean something magic.</span>
 QString text = MyMagicClass::tr(&quot;Sim sala bim.&quot;);</pre>
<p>Meta-data appearing right in front of a magic TRANSLATOR comment applies to the whole TS file.</p>
<a name="disambiguation"></a>
<h2>Disambiguation</h2>
<p>If the same translatable string is used in different roles within the same translation context, an additional identifying string may be passed in the call to <a href="qobject.html#tr">tr()</a>. This optional disambiguation argument is used to distinguish between otherwise identical strings.</p>
<p>Example:</p>
<pre class="highlightedCode brush: cpp"> MyWindow::MyWindow()
 {
     QLabel *senderLabel = new QLabel(tr(&quot;Name:&quot;));
     QLabel *recipientLabel = new QLabel(tr(&quot;Name:&quot;, &quot;recipient&quot;));
     ...</pre>
<p>In Qt 4.4 and earlier, this disambiguation parameter was the preferred way to specify comments to translators.</p>
<a name="character-encodings"></a>
<h2>Character Encodings</h2>
<p>You can set the encoding for the source text by calling <a href="qtextcodec.html#setCodecForTr">QTextCodec::setCodecForTr</a>(). By default, the source text is assumed to be in Latin-1 encoding.</p>
<a name="handling-plurals"></a>
<h2>Handling Plurals</h2>
<p>Some translatable strings contain placeholders for integer values and need to be translated differently depending on the values in use.</p>
<p>To help with this problem, developers pass an additional integer argument to the <a href="qobject.html#tr">tr()</a> function, and typically use a special notation for plurals in each translatable string.</p>
<p>If this argument is equal or greater than zero, all occurrences of <tt>%n</tt> in the resulting string are replaced with a decimal representation of the value supplied. In addition, the translation used will adapt to the value according to the rules for each language.</p>
<p>Example:</p>
<pre class="highlightedCode brush: cpp"> int n = messages.count();
 showMessage(tr(&quot;%n message(s) saved&quot;, &quot;&quot;, n));</pre>
<p>The table below shows what string is returned depending on the active translation:</p>
<table class="generic">
<thead><tr class="qt-style topAlign"><th ></th><th  colspan="3">Active Translation</th></tr>
<tr class="qt-style topAlign"><th ><i>n</i></th><th >No Translation</th><th >French</th><th >English</th></tr></thead>
<tr class="odd topAlign"><td ><p>0</p></td><td ><p>&quot;0 message(s) saved&quot;</p></td><td ><p>&quot;0 message sauvegardé&quot;</p></td><td ><p>&quot;0 message<b>s</b> saved&quot;</p></td></tr>
<tr class="even topAlign"><td ><p>1</p></td><td ><p>&quot;1 message(s) saved&quot;</p></td><td ><p>&quot;1 message sauvegardé&quot;</p></td><td ><p>&quot;1 message saved&quot;</p></td></tr>
<tr class="odd topAlign"><td ><p>2</p></td><td ><p>&quot;2 message(s) saved&quot;</p></td><td ><p>&quot;2 message<b>s</b> sauvegardé<b>s</b>&quot;</p></td><td ><p>&quot;2 message<b>s</b> saved&quot;</p></td></tr>
<tr class="even topAlign"><td ><p>37</p></td><td ><p>&quot;37 message(s) saved&quot;</p></td><td ><p>&quot;37 message<b>s</b> sauvegardé<b>s</b>&quot;</p></td><td ><p>&quot;37 message<b>s</b> saved&quot;</p></td></tr>
</table>
<p>This idiom is more flexible than the traditional approach; e.g&#x2e;,</p>
<pre class="highlightedCode brush: cpp"> n == 1 ? tr(&quot;%n message saved&quot;) : tr(&quot;%n messages saved&quot;)</pre>
<p>because it also works with target languages that have several plural forms (e.g&#x2e;, Irish has a special &quot;dual&quot; form that should be used when <tt>n</tt> is 2), and it handles the <i>n</i> == 0 case correctly for languages such as French that require the singular. See the <a href="linguist-manual.html">Qt Linguist Manual</a> for details.</p>
<p>Instead of <tt>%n</tt>, you can use <tt>%Ln</tt> to produce a localized representation of <i>n</i>. The conversion uses the default locale, set using <a href="qlocale.html#setDefault">QLocale::setDefault</a>(). (If no default locale was specified, the &quot;C&quot; locale is used.)</p>
<p>A summary of the rules used to translate strings containing plurals can be found in the <a href="i18n-plural-rules.html">Translation Rules for Plurals</a> document.</p>
<a name="enabling-translation"></a>
<h2>Enabling Translation</h2>
<p>Typically, your application's <tt>main()</tt> function will look like this:</p>
<pre class="highlightedCode brush: cpp"> int main(int argc, char *argv[])
 {
     QApplication app(argc, argv);

     QTranslator qtTranslator;
     qtTranslator.load(&quot;qt_&quot; + QLocale::system().name(),
             QLibraryInfo::location(QLibraryInfo::TranslationsPath));
     app.installTranslator(&amp;qtTranslator);

     QTranslator myappTranslator;
     myappTranslator.load(&quot;myapp_&quot; + QLocale::system().name());
     app.installTranslator(&amp;myappTranslator);

     ...
     return app.exec();
 }</pre>
<p>Note the use of <a href="qlibraryinfo.html#location">QLibraryInfo::location</a>() to locate the Qt translations. Developers should request the path to the translations at run-time by passing <a href="qlibraryinfo.html#LibraryLocation-enum">QLibraryInfo::TranslationsPath</a> to this function instead of using the <tt>QTDIR</tt> environment variable in their applications.</p>
<a name="further-reading"></a>
<h2>Further Reading</h2>
<p><a href="linguist-manual.html">Qt Linguist Manual</a>, <a href="linguist-hellotr.html">Hello tr</a>() Example, <a href="i18n-plural-rules.html">Translation Rules for Plurals</a></p>
</div>
<!-- @@@i18n-source-translation.html -->
<p>
[Previous: <a href="internationalization.html">Internationalization with Qt</a>]
[Next: <a href="i18n-plural-rules.html">Translation Rules for Plurals</a>]
</p>
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
