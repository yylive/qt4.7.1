<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- textfinder.qdoc -->
  <title>Qt 4.7: Text Finder Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li>Text Finder Example</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#setting-up-the-resource-file">Setting Up The Resource File</a></li>
<li class="level1"><a href="#textfinder-class-definition">TextFinder Class Definition</a></li>
<li class="level1"><a href="#textfinder-class-implementation">TextFinder Class Implementation</a></li>
<li class="level1"><a href="#function"><tt>main()</tt> Function</a></li>
</ul>
</div>
<h1 class="title">Text Finder Example</h1>
<span class="subtitle"></span>
<!-- $$$uitools/textfinder-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="uitools-textfinder-textfinder-cpp.html">uitools/textfinder/textfinder.cpp</a></li>
<li><a href="uitools-textfinder-textfinder-h.html">uitools/textfinder/textfinder.h</a></li>
<li><a href="uitools-textfinder-forms-textfinder-ui.html">uitools/textfinder/forms/textfinder.ui</a></li>
<li><a href="uitools-textfinder-main-cpp.html">uitools/textfinder/main.cpp</a></li>
<li><a href="uitools-textfinder-textfinder-pro.html">uitools/textfinder/textfinder.pro</a></li>
<li><a href="uitools-textfinder-textfinder-qrc.html">uitools/textfinder/textfinder.qrc</a></li>
</ul>
<p>The Text Finder example demonstrates how to dynamically process forms using the <a href="qtuitools.html">QtUiTools</a> module. Dynamic form processing enables a form to be processed at run-time only by changing the UI file for the project. The program allows the user to look up a particular word within the contents of a text file. This text file is included in the project's resource and is loaded into the display at startup.</p>
<table class="generic">
<tr class="odd topAlign"><td ><p><img src="images/textfinder-example-find.png" /></p></td><td ><p><img src="images/textfinder-example-find2.png" /></p></td></tr>
</table>
<a name="setting-up-the-resource-file"></a>
<h2>Setting Up The Resource File</h2>
<p>The resources required for Text Finder are:</p>
<ul>
<li><i>textfinder.ui</i> - the user interface file created in <a href="qtdesigner.html">QtDesigner</a></li>
<li><i>input.txt</i> - a text file containing some text to be displayed in the <a href="qtextedit.html">QTextEdit</a></li>
</ul>
<p><i>textfinder.ui</i> contains all the necessary <a href="qwidget.html">QWidget</a> objects for the Text Finder. A <a href="qlineedit.html">QLineEdit</a> is used for the user input, a <a href="qtextedit.html">QTextEdit</a> is used to display the contents of <i>input.txt</i>, a <a href="qlabel.html">QLabel</a> is used to display the text &quot;Keyword&quot;, and a <a href="qpushbutton.html">QPushButton</a> is used for the &quot;Find&quot; button. The screenshot below shows the preview obtained in <a href="qtdesigner.html">QtDesigner</a>.</p>
<p class="centerAlign"><img src="images/textfinder-example-userinterface.png" /></p><p>A <i>textfinder.qrc</i> file is used to store both the <i>textfinder.ui</i> and <i>input.txt</i> in the application's executable. The file contains the following code:</p>
<pre class="highlightedCode brush: cpp"> &lt;!DOCTYPE RCC&gt;&lt;RCC version=&quot;1.0&quot;&gt;
 &lt;qresource&gt;
     &lt;file&gt;forms/textfinder.ui&lt;/file&gt;
     &lt;file&gt;forms/input.txt&lt;/file&gt;
 &lt;/qresource&gt;
 &lt;/RCC&gt;</pre>
<p>For more information on resource files, see <a href="resources.html">The Qt Resource System</a>.</p>
<p>To generate a form at run-time, the example is linked against the <a href="qtuitools.html">QtUiTools</a> module library. This is done in the <tt>textfinder.pro</tt> file that contains the following lines:</p>
<pre class="highlightedCode brush: cpp"> CONFIG      += uitools
 HEADERS     = textfinder.h
 RESOURCES   = textfinder.qrc
 SOURCES     = textfinder.cpp main.cpp</pre>
<a name="textfinder-class-definition"></a>
<h2>TextFinder Class Definition</h2>
<p>The <tt>TextFinder</tt> class is a subclass of <a href="qwidget.html">QWidget</a> and it hosts the <a href="qwidget.html">QWidget</a>s we need to access in the user interface. The <a href="qlabel.html">QLabel</a> in the user interface is not declared here as we do not need to access it.</p>
<pre class="highlightedCode brush: cpp"> class TextFinder : public QWidget
 {
     Q_OBJECT

 public:
     TextFinder(QWidget *parent = 0);

 private slots:
     void on_findButton_clicked();

 private:
     QWidget* loadUiFile();
     void loadTextFile();

     QPushButton *ui_findButton;
     QTextEdit *ui_textEdit;
     QLineEdit *ui_lineEdit;
     bool isFirstTime;
 };</pre>
<p>The slot <tt>on_find_Button_clicked()</tt> is a slot named according to the <a href="designer-using-a-ui-file.html#automatic-connections">Automatic Connection</a> naming convention required by <tt>uic</tt>.</p>
<a name="textfinder-class-implementation"></a>
<h2>TextFinder Class Implementation</h2>
<p>The <tt>TextFinder</tt> class's constructor calls the <tt>loadUiFile()</tt> function and then uses <tt>qFindChild()</tt> to access the user interface's <a href="qwidget.html">QWidget</a>s.</p>
<pre class="highlightedCode brush: cpp"> TextFinder::TextFinder(QWidget *parent)
     : QWidget(parent)
 {
     QWidget *formWidget = loadUiFile();

     ui_findButton = qFindChild&lt;QPushButton*&gt;(this, &quot;findButton&quot;);
     ui_textEdit = qFindChild&lt;QTextEdit*&gt;(this, &quot;textEdit&quot;);
     ui_lineEdit = qFindChild&lt;QLineEdit*&gt;(this, &quot;lineEdit&quot;);</pre>
<p>We then use <a href="qmetaobject.html">QMetaObject</a>'s system to enable signal and slot connections.</p>
<pre class="highlightedCode brush: cpp">     QMetaObject::connectSlotsByName(this);</pre>
<p>The loadTextFile() function is called to load <tt>input.txt</tt> into <a href="qtextedit.html">QTextEdit</a> to displays its contents.</p>
<pre class="highlightedCode brush: cpp">     loadTextFile();</pre>
<p>The <tt>TextFinder</tt>'s layout is set with <a href="qwidget.html#setLayout">setLayout()</a>.</p>
<pre class="highlightedCode brush: cpp">     QVBoxLayout *layout = new QVBoxLayout;
     layout-&gt;addWidget(formWidget);
     setLayout(layout);</pre>
<p>Finally, the window title is set to <i>Text Finder</i> and <tt>isFirstTime</tt> is set to true.</p>
<p><tt>isFirstTime</tt> is used as a flag to indicate whether the search operation has been performed more than once. This is further explained with the <tt>on_findButton_clicked()</tt> function.</p>
<p>The <tt>loadUiFile()</tt> function is used to load the user interface file previously created in <a href="qtdesigner.html">QtDesigner</a>. The <a href="quiloader.html">QUiLoader</a> class is instantiated and its <tt>load()</tt> function is used to load the form into <tt>formWidget</tt> that acts as a place holder for the user interface. The function then returns <tt>formWidget</tt> to its caller.</p>
<pre class="highlightedCode brush: cpp"> QWidget* TextFinder::loadUiFile()
 {
     QUiLoader loader;

     QFile file(&quot;:/forms/textfinder.ui&quot;);
     file.open(QFile::ReadOnly);

     QWidget *formWidget = loader.load(&amp;file, this);
     file.close();

     return formWidget;
 }</pre>
<p>As mentioned earlier, the loadTextFile() function loads <i>input.txt</i> into <a href="qtextedit.html">QTextEdit</a> to display its contents. Data is read using <a href="qtextstream.html">QTextStream</a> into a <a href="qstring.html">QString</a> object, <tt>line</tt> with the <a href="qtextstream.html#readAll">QTextStream::readAll</a>() function. The contents of <tt>line</tt> are then appended to <tt>ui_textEdit</tt>.</p>
<pre class="highlightedCode brush: cpp"> void TextFinder::loadTextFile()
 {
     QFile inputFile(&quot;:/forms/input.txt&quot;);
     inputFile.open(QIODevice::ReadOnly);
     QTextStream in(&amp;inputFile);
     QString line = in.readAll();
     inputFile.close();

     ui_textEdit-&gt;append(line);
     ui_textEdit-&gt;setUndoRedoEnabled(false);
     ui_textEdit-&gt;setUndoRedoEnabled(true);
 }</pre>
<p>The <tt>on_findButton_clicked()</tt> function is a slot that is connected to <tt>ui_findButton</tt>'s <tt>clicked()</tt> signal. The <tt>searchString</tt> is extracted from the <tt>ui_lineEdit</tt> and the <tt>document</tt> is extracted from <tt>textEdit</tt>. In event there is an empty <tt>searchString</tt>, a <a href="qmessagebox.html">QMessageBox</a> is used, requesting the user to enter a word. Otherwise, we traverse through the words in <tt>ui_textEdit</tt>, and highlight all ocurrences of the <tt>searchString</tt> . Two <a href="qtextcursor.html">QTextCursor</a> objects are used: One to traverse through the words in <tt>line</tt> and another to keep track of the edit blocks.</p>
<pre class="highlightedCode brush: cpp"> void TextFinder::on_findButton_clicked()
 {
     QString searchString = ui_lineEdit-&gt;text();
     QTextDocument *document = ui_textEdit-&gt;document();

     bool found = false;

     if (isFirstTime == false)
         document-&gt;undo();

     if (searchString.isEmpty()) {
         QMessageBox::information(this, tr(&quot;Empty Search Field&quot;),
                 &quot;The search field is empty. Please enter a word and click Find.&quot;);
     } else {

         QTextCursor highlightCursor(document);
         QTextCursor cursor(document);

         cursor.beginEditBlock();

         QTextCharFormat plainFormat(highlightCursor.charFormat());
         QTextCharFormat colorFormat = plainFormat;
         colorFormat.setForeground(Qt::red);

         while (!highlightCursor.isNull() &amp;&amp; !highlightCursor.atEnd()) {
             highlightCursor = document-&gt;find(searchString, highlightCursor, QTextDocument::FindWholeWords);

             if (!highlightCursor.isNull()) {
                 found = true;
                 highlightCursor.movePosition(QTextCursor::WordRight,
                                        QTextCursor::KeepAnchor);
                 highlightCursor.mergeCharFormat(colorFormat);
             }
         }

         cursor.endEditBlock();</pre>
<p>The <tt>isFirstTime</tt> flag is set to false the moment <tt>findButton</tt> is clicked. This is necessary to undo the previous text highlight before highlighting the user's next search string. Also, the <tt>found</tt> flag is used to indicate if the <tt>searchString</tt> was found within the contents of <tt>ui_textEdit</tt>. If it was not found, a <a href="qmessagebox.html">QMessageBox</a> is used to inform the user.</p>
<pre class="highlightedCode brush: cpp">         isFirstTime = false;

         if (found == false) {
             QMessageBox::information(this, tr(&quot;Word Not Found&quot;),
                 &quot;Sorry, the word cannot be found.&quot;);
         }
     }
 }</pre>
<a name="function"></a>
<h2><tt>main()</tt> Function</h2>
<pre class="highlightedCode brush: cpp"> int main(int argc, char *argv[])
 {
     Q_INIT_RESOURCE(textfinder);
     QApplication app(argc, argv);

     TextFinder *textFinder = new TextFinder;
     textFinder-&gt;show();

     return app.exec();
 }</pre>
<p>The <tt>main()</tt> function initialises the <i>textfinder.qrc</i> resource file and instantiates as well as displays <tt>TextFinder</tt>.</p>
</div>
<p>See also <a href="designer-calculatorbuilder.html">Calculator Builder Example</a> and <a href="designer-worldtimeclockbuilder.html">World Time Clock Builder Example</a>.</p>
<!-- @@@uitools/textfinder -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
