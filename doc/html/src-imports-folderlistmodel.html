<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- qml-folderlistmodel.qdoc -->
  <title>Qt 4.7: FolderListModel - a C++ model plugin</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li>FolderListModel - a C++ model plugin</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#usage-from-qml">Usage from QML</a></li>
<li class="level1"><a href="#defining-the-model">Defining the Model</a></li>
<li class="level1"><a href="#connecting-the-model-to-qml">Connecting the Model to QML</a></li>
<li class="level1"><a href="#implementing-the-model">Implementing the Model</a></li>
</ul>
</div>
<h1 class="title">FolderListModel - a C++ model plugin</h1>
<span class="subtitle"></span>
<!-- $$$src/imports/folderlistmodel-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="src-imports-folderlistmodel-plugin-cpp.html">src/imports/folderlistmodel/plugin.cpp</a></li>
<li><a href="src-imports-folderlistmodel-qdeclarativefolderlistmodel-cpp.html">src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp</a></li>
<li><a href="src-imports-folderlistmodel-qdeclarativefolderlistmodel-h.html">src/imports/folderlistmodel/qdeclarativefolderlistmodel.h</a></li>
<li><a href="src-imports-folderlistmodel-folderlistmodel-pro.html">src/imports/folderlistmodel/folderlistmodel.pro</a></li>
<li><a href="src-imports-folderlistmodel-qmldir.html">src/imports/folderlistmodel/qmldir</a></li>
</ul>
<p>This plugin shows how to make a C++ model available to QML. It presents a simple file list for a single folder (directory) and allows the presented folder to be changed.</p>
<p class="centerAlign"><img src="images/declarative-folderlistmodel.png" alt="The FolderListModel used to choose a QML file" /></p><p>We do not explain the model implementation in detail, but rather focus on the mechanics of making the model available to QML.</p>
<a name="usage-from-qml"></a>
<h2>Usage from QML</h2>
<p>The type we are creating can be used from QML like this:</p>
<pre class="highlightedCode brush: cpp"> import QtQuick 1.0
 import Qt.labs.folderlistmodel 1.0

 ListView {
     FolderListModel {
         id: foldermodel
         nameFilters: [&quot;*.qml&quot;]
     }
     Component {
         id: filedelegate
         Text { text: fileName }
     }
     model: foldermodel
     delegate: filedelegate
 }</pre>
<a name="defining-the-model"></a>
<h2>Defining the Model</h2>
<p>We are subclassing <a href="qabstractlistmodel.html">QAbstractListModel</a> which will allow us to give data to QML and send notifications when the data changes:</p>
<pre class="highlightedCode brush: cpp"> class QDeclarativeFolderListModel : public QAbstractListModel, public QDeclarativeParserStatus
 {
     Q_OBJECT
     Q_INTERFACES(QDeclarativeParserStatus)</pre>
<p>As you see, we also inherit the <a href="qdeclarativeparserstatus.html">QDeclarativeParserStatus</a> interface, so that we can delay initial processing until we have all properties set (via componentComplete() below).</p>
<p>The first thing to do when devising a new type for QML is to define the properties you want the type to have:</p>
<pre class="highlightedCode brush: cpp">     Q_PROPERTY(QUrl folder READ folder WRITE setFolder NOTIFY folderChanged)
     Q_PROPERTY(QUrl parentFolder READ parentFolder NOTIFY folderChanged)
     Q_PROPERTY(QStringList nameFilters READ nameFilters WRITE setNameFilters)
     Q_PROPERTY(SortField sortField READ sortField WRITE setSortField)
     Q_PROPERTY(bool sortReversed READ sortReversed WRITE setSortReversed)
     Q_PROPERTY(bool showDirs READ showDirs WRITE setShowDirs)
     Q_PROPERTY(bool showDotAndDotDot READ showDotAndDotDot WRITE setShowDotAndDotDot)
     Q_PROPERTY(bool showOnlyReadable READ showOnlyReadable WRITE setShowOnlyReadable)
     Q_PROPERTY(int count READ count)</pre>
<p>The purposes of each of these should be pretty obvious - in QML we will set the folder to display (a file: URL), and the kinds of files we want to show in the view of the model.</p>
<p>Next are the constructor, destructor, and standard <a href="qabstractlistmodel.html">QAbstractListModel</a> subclassing requirements:</p>
<pre class="highlightedCode brush: cpp"> public:
     QDeclarativeFolderListModel(QObject *parent = 0);
     ~QDeclarativeFolderListModel();

     enum Roles { FileNameRole = Qt::UserRole+1, FilePathRole = Qt::UserRole+2 };

     int rowCount(const QModelIndex &amp;parent) const;
     QVariant data(const QModelIndex &amp;index, int role) const;</pre>
<p>The data() function is where we provide model values. The rowCount() function is also a standard part of the <a href="qabstractlistmodel.html">QAbstractListModel</a> interface, but we also want to provide a simpler count property:</p>
<pre class="highlightedCode brush: cpp">     int count() const { return rowCount(QModelIndex()); }</pre>
<p>Then we have the functions for the remaining properties which we defined above:</p>
<pre class="highlightedCode brush: cpp">     QUrl folder() const;
     void setFolder(const QUrl &amp;folder);

     QUrl parentFolder() const;

     QStringList nameFilters() const;
     void setNameFilters(const QStringList &amp;filters);

     enum SortField { Unsorted, Name, Time, Size, Type };
     SortField sortField() const;
     void setSortField(SortField field);
     Q_ENUMS(SortField)

     bool sortReversed() const;
     void setSortReversed(bool rev);

     bool showDirs() const;
     void  setShowDirs(bool);
     bool showDotAndDotDot() const;
     void  setShowDotAndDotDot(bool);
     bool showOnlyReadable() const;
     void  setShowOnlyReadable(bool);</pre>
<p>Imperative actions upon the model are made available to QML via a <a href="qobject.html#Q_INVOKABLE">Q_INVOKABLE</a> tag on a normal member function. The isFolder(index) function says whether the value at <i>index</i> is a folder:</p>
<pre class="highlightedCode brush: cpp">     Q_INVOKABLE bool isFolder(int index) const;</pre>
<p>Then we have the <a href="qdeclarativeparserstatus.html">QDeclarativeParserStatus</a> interface:</p>
<pre class="highlightedCode brush: cpp">     virtual void classBegin();
     virtual void componentComplete();</pre>
<p>Then the NOTIFY function for the folders property. The implementation will emit this when the folder property is changed.</p>
<pre class="highlightedCode brush: cpp"> Q_SIGNALS:
     void folderChanged();</pre>
<p>The class ends with some implementation details:</p>
<pre class="highlightedCode brush: cpp"> private Q_SLOTS:
     void refresh();
     void inserted(const QModelIndex &amp;index, int start, int end);
     void removed(const QModelIndex &amp;index, int start, int end);
     void handleDataChanged(const QModelIndex &amp;start, const QModelIndex &amp;end);

 private:
     Q_DISABLE_COPY(QDeclarativeFolderListModel)
     QDeclarativeFolderListModelPrivate *d;
 };</pre>
<p>Lastly, the boilerplare to declare the type for QML use:</p>
<pre class="highlightedCode brush: cpp"> QML_DECLARE_TYPE(QDeclarativeFolderListModel)</pre>
<a name="connecting-the-model-to-qml"></a>
<h2>Connecting the Model to QML</h2>
<p>To make this class available to QML, we only need to make a simple subclass of <a href="qdeclarativeextensionplugin.html">QDeclarativeExtensionPlugin</a>:</p>
<pre class="highlightedCode brush: cpp"> class QmlFolderListModelPlugin : public QDeclarativeExtensionPlugin
 {
     Q_OBJECT
 public:
     virtual void registerTypes(const char *uri)
     {
         Q_ASSERT(QLatin1String(uri) == QLatin1String(&quot;Qt.labs.folderlistmodel&quot;));
 #ifndef QT_NO_DIRMODEL
         qmlRegisterType&lt;QDeclarativeFolderListModel&gt;(uri,1,0,&quot;FolderListModel&quot;);
 #endif
     }
 };</pre>
<p>and then use the standard Qt plugin export macro:</p>
<pre class="highlightedCode brush: cpp"> Q_EXPORT_PLUGIN2(qmlfolderlistmodelplugin, QT_PREPEND_NAMESPACE(QmlFolderListModelPlugin));</pre>
<p>Finally, in order for QML to connect the &quot;import&quot; statement to our plugin, we list it in the qmldir file:</p>
<p><a href="src-imports-folderlistmodel-qmldir.html">src/imports/folderlistmodel/qmldir</a></p>
<p>This qmldir file and the compiled plugin will be installed in <tt>$QTDIR/imports/Qt/labs/folderlistmodel/</tt> where the QML engine will find it (since <tt>$QTDIR/imports</tt> is the value of QLibraryInf::libraryPath()).</p>
<a name="implementing-the-model"></a>
<h2>Implementing the Model</h2>
<p>We'll not discuss the model implementation in detail, as it is not specific to QML - any Qt C++ model can be interfaced to QML. This implementation is basically just takes the krufty old <a href="qdirmodel.html" class="obsolete">QDirModel<sup>(obsolete)</sup></a>, which is a tree with lots of detailed roles and re-presents it as a simpler list model where each item is just a fileName and a filePath (as a file: URL rather than a plain file, since QML works with URLs for all content).</p>
<p><a href="src-imports-folderlistmodel-qdeclarativefolderlistmodel-cpp.html">src/imports/folderlistmodel/qdeclarativefolderlistmodel.cpp</a></p>
</div>
<!-- @@@src/imports/folderlistmodel -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
