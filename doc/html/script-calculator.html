<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- qtscriptcalculator.qdoc -->
  <title>Qt 4.7: QtScript Calculator Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li>QtScript Calculator Example</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<h1 class="title">QtScript Calculator Example</h1>
<span class="subtitle"></span>
<!-- $$$script/calculator-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="script-calculator-calculator-js.html">script/calculator/calculator.js</a></li>
<li><a href="script-calculator-calculator-ui.html">script/calculator/calculator.ui</a></li>
<li><a href="script-calculator-main-cpp.html">script/calculator/main.cpp</a></li>
<li><a href="script-calculator-calculator-pro.html">script/calculator/calculator.pro</a></li>
<li><a href="script-calculator-calculator-qrc.html">script/calculator/calculator.qrc</a></li>
</ul>
<p>In this simple <a href="qtscript.html">QtScript</a> example, we show how to implement the functionality of a calculator widget.</p>
<p class="centerAlign"><img src="images/qtscript-calculator-example.png" /></p><p>The program logic in this example is a fairly straight port of the logic in the C++ <a href="widgets-calculator.html">Calculator Example</a>. The graphical user interface is defined in a UI file.</p>
<p>The C++ part of the example consists of four steps:</p>
<ul>
<li>Evaluate the script code that defines the <tt>Calculator</tt> class.<pre class="highlightedCode brush: cpp">     QScriptEngine engine;
     QString scriptFileName(&quot;:/calculator.js&quot;);
     QFile scriptFile(scriptFileName);
     scriptFile.open(QIODevice::ReadOnly);
     engine.evaluate(scriptFile.readAll(), scriptFileName);
     scriptFile.close();</pre>
</li>
<li>Create a widget from the UI file using <a href="quiloader.html">QUiLoader</a>.<pre class="highlightedCode brush: cpp">     QUiLoader loader;
     QFile uiFile(&quot;:/calculator.ui&quot;);
     uiFile.open(QIODevice::ReadOnly);
     QWidget *ui = loader.load(&amp;uiFile);
     uiFile.close();</pre>
</li>
<li>Call the Calculator constructor function to create a new <tt>Calculator</tt> script object, passing the widget as argument.<pre class="highlightedCode brush: cpp">     QScriptValue ctor = engine.evaluate(&quot;Calculator&quot;);
     QScriptValue scriptUi = engine.newQObject(ui, QScriptEngine::ScriptOwnership);
     QScriptValue calc = ctor.construct(QScriptValueList() &lt;&lt; scriptUi);</pre>
</li>
<li>Show the widget and start the application event loop.<pre class="highlightedCode brush: cpp">     ui-&gt;show();
     return app.exec();</pre>
</li>
</ul>
<p>On the script side, the <tt>Calculator</tt> constructor function initializes the instance variables of the new <tt>Calculator</tt> object, and connects the clicked() signal of the form's buttons to corresponding functions defined in the <tt>Calculator</tt> prototype object; the effect is that when a button is clicked, the proper script function will be invoked to carry out the operation.</p>
<pre class="highlightedCode brush: cpp"> function Calculator(ui)
 {
     this.ui = ui;

     this.pendingAdditiveOperator = Calculator.NO_OPERATOR;
     this.pendingMultiplicativeOperator = Calculator.NO_OPERATOR;
     this.sumInMemory = 0;
     this.sumSoFar = 0;
     this.factorSoFar = 0;
     this.waitingForOperand = true;

     with (ui) {
         display.text = &quot;0&quot;;

         zeroButton.clicked.connect(this.digitClicked.bind(this, 0));
         oneButton.clicked.connect(this.digitClicked.bind(this, 1));
         twoButton.clicked.connect(this.digitClicked.bind(this, 2));
         threeButton.clicked.connect(this.digitClicked.bind(this, 3));
         fourButton.clicked.connect(this.digitClicked.bind(this, 4));
         fiveButton.clicked.connect(this.digitClicked.bind(this, 5));
         sixButton.clicked.connect(this.digitClicked.bind(this, 6));
         sevenButton.clicked.connect(this.digitClicked.bind(this, 7));
         eightButton.clicked.connect(this.digitClicked.bind(this, 8));
         nineButton.clicked.connect(this.digitClicked.bind(this, 9));

         pointButton.clicked.connect(this, &quot;pointClicked&quot;);
         changeSignButton.clicked.connect(this, &quot;changeSignClicked&quot;);

         backspaceButton.clicked.connect(this, &quot;backspaceClicked&quot;);
         clearButton.clicked.connect(this, &quot;clear&quot;);
         clearAllButton.clicked.connect(this, &quot;clearAll&quot;);

         clearMemoryButton.clicked.connect(this, &quot;clearMemory&quot;);
         readMemoryButton.clicked.connect(this, &quot;readMemory&quot;);
         setMemoryButton.clicked.connect(this, &quot;setMemory&quot;);
         addToMemoryButton.clicked.connect(this, &quot;addToMemory&quot;);

         divisionButton.clicked.connect(this.multiplicativeOperatorClicked.bind(this, Calculator.DIVISION_OPERATOR));
         timesButton.clicked.connect(this.multiplicativeOperatorClicked.bind(this, Calculator.TIMES_OPERATOR));
         minusButton.clicked.connect(this.additiveOperatorClicked.bind(this, Calculator.MINUS_OPERATOR));
         plusButton.clicked.connect(this.additiveOperatorClicked.bind(this, Calculator.PLUS_OPERATOR));

         squareRootButton.clicked.connect(this.unaryOperatorClicked.bind(this, Calculator.SQUARE_OPERATOR));
         powerButton.clicked.connect(this.unaryOperatorClicked.bind(this, Calculator.POWER_OPERATOR));
         reciprocalButton.clicked.connect(this.unaryOperatorClicked.bind(this, Calculator.RECIPROCAL_OPERATOR));
         equalButton.clicked.connect(this, &quot;equalClicked&quot;);
     }
 }</pre>
<p>A <tt>Calculator</tt> object is just a plain script object; it is not a widget. Instead, it stores a reference to the calculator form (the widget) in an instance variable, <tt>ui</tt>. The calculator script functions can access components of the form by referring to the proper children of the <tt>ui</tt> member.</p>
<pre class="highlightedCode brush: cpp"> Calculator.prototype.digitClicked = function(digitValue)
 {
     if ((digitValue == 0) &amp;&amp; (this.ui.display.text == &quot;0&quot;))
         return;
     if (this.waitingForOperand) {
         this.ui.display.clear();
         this.waitingForOperand = false;
     }
     this.ui.display.text += digitValue;
 }</pre>
<p>The digitClicked() function is called when a digit button is clicked, with the input digit as argument.</p>
<pre class="highlightedCode brush: cpp"> Calculator.prototype.changeSignClicked = function()
 {
     var text = this.ui.display.text;
     var value = text - 0;

     if (value &gt; 0) {
         text = &quot;-&quot; + text;
     } else if (value &lt; 0) {
         text = text.slice(1);
     }
     this.ui.display.text = text;
 }</pre>
<p>The changeSign() function shows how we retrieve the text property of the calculator's display, change it appropriately, and write back the new value.</p>
</div>
<!-- @@@script/calculator -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
