<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- javascriptblocks.qdoc -->
  <title>Qt 4.7: Integrating JavaScript</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li>Integrating JavaScript</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#inline-javascript">Inline JavaScript</a></li>
<li class="level1"><a href="#separate-javascript-files">Separate JavaScript files</a></li>
<li class="level2"><a href="#code-behind-implementation-files">Code-Behind Implementation Files</a></li>
<li class="level2"><a href="#stateless-javascript-libraries">Stateless JavaScript libraries</a></li>
<li class="level1"><a href="#running-javascript-at-startup">Running JavaScript at Startup</a></li>
<li class="level1"><a href="#property-assignment-vs-property-binding">Property Assignment vs Property Binding</a></li>
<li class="level1"><a href="#qml-javascript-restrictions">QML JavaScript Restrictions</a></li>
</ul>
</div>
<h1 class="title">Integrating JavaScript</h1>
<span class="subtitle"></span>
<!-- $$$qdeclarativejavascript.html-description -->
<div class="descr"> <a name="details"></a>
<p>QML encourages building UIs declaratively, using <a href="propertybinding.html">Property Binding</a> and the composition of existing <a href="qdeclarativeelements.html">QML Elements</a>. To allow the implementation of more advanced behavior, QML integrates tightly with imperative <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code.</p>
<p>The <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> environment provided by QML is stricter than that in a web browser. In QML you cannot add, or modify, members of the <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> global object. It is possible to do this accidentally by using a variable without declaring it. In QML this will throw an exception, so all local variables should be explicitly declared.</p>
<p>In addition to the standard <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> properties, the <a href="qdeclarativeglobalobject.html">QML Global Object</a> includes a number of helper methods that simplify building UIs and interacting with the QML environment.</p>
<a name="inline-javascript"></a>
<h2>Inline JavaScript</h2>
<p>Small <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> functions can be written inline with other QML declarations. These inline functions are added as methods to the QML element that contains them.</p>
<pre class="highlightedCode brush: cpp"> Item {
     function factorial(a) {
         a = parseInt(a);
         if (a &lt;= 0)
             return 1;
         else
             return a * factorial(a - 1);
     }

     MouseArea {
         anchors.fill: parent
         onClicked: console.log(factorial(10))
     }
 }</pre>
<p>As methods, inline functions on the root element in a QML component can be invoked by callers outside the component. If this is not desired, the method can be added to a non-root element or, preferably, written in an external <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> file.</p>
<a name="separate-javascript-files"></a>
<h2>Separate JavaScript files</h2>
<p>Large blocks of <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> should be written in separate files. These files can be imported into QML files using an <tt>import</tt> statement, in the same way that <a href="qdeclarativemodules.html">modules</a> are imported.</p>
<p>For example, the <tt>factorial()</tt> method in the above example for <a href="#inline-javascript">Inline JavaScript</a> could be moved into an external file named <tt>factorial.js</tt>, and accessed like this:</p>
<pre class="highlightedCode brush: cpp"> import &quot;factorial.js&quot; as MathFunctions
 Item {
     MouseArea {
         anchors.fill: parent
         onClicked: console.log(MathFunctions.factorial(10))
     }
 }</pre>
<p>Both relative and absolute <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> URLs can be imported. In the case of a relative URL, the location is resolved relative to the location of the <a href="qdeclarativedocuments.html">QML Document</a> that contains the import. If the script file is not accessible, an error will occur. If the <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> needs to be fetched from a network resource, the QML document has a &quot;Loading&quot; <a href="qdeclarativecomponent.html#status-prop">status</a> until the script has been downloaded.</p>
<p>Imported <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files are always qualified using the &quot;as&quot; keyword. The qualifier for <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files must be unique, so there is always a one-to-one mapping between qualifiers and <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files.</p>
<a name="code-behind-implementation-files"></a>
<h3>Code-Behind Implementation Files</h3>
<p>Most <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files imported into a QML file are stateful, logic implementations for the QML file importing them. In these cases, for QML component instances to behave correctly each instance requires a separate copy of the <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> objects and state.</p>
<p>The default behavior when importing <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files is to provide a unique, isolated copy for each QML component instance. The code runs in the same scope as the QML component instance and consequently can can access and manipulate the objects and properties declared.</p>
<a name="stateless-javascript-libraries"></a>
<h3>Stateless JavaScript libraries</h3>
<p>Some <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> files act more like libraries - they provide a set of stateless helper functions that take input and compute output, but never manipulate QML component instances directly.</p>
<p>As it would be wasteful for each QML component instance to have a unique copy of these libraries, the <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> programmer can indicate a particular file is a stateless library through the use of a pragma, as shown in the following example.</p>
<pre class="highlightedCode brush: cpp"> // factorial.js
 .pragma library

 function factorial(a) {
     a = parseInt(a);
     if (a &lt;= 0)
         return 1;
     else
         return a * factorial(a - 1);
 }</pre>
<p>The pragma declaration must appear before any <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code excluding comments.</p>
<p>As they are shared, stateless library files cannot access QML component instance objects or properties directly, although QML values can be passed as function parameters.</p>
<a name="running-javascript-at-startup"></a>
<h2>Running JavaScript at Startup</h2>
<p>It is occasionally necessary to run some imperative code at application (or component instance) startup. While it is tempting to just include the startup script as <i>global code</i> in an external script file, this can have severe limitations as the QML environment may not have been fully established. For example, some objects might not have been created or some <a href="propertybinding.html">Property Binding</a>s may not have been run. <a href="#qml-javascript-restrictions">QML JavaScript Restrictions</a> covers the exact limitations of global script code.</p>
<p>The QML <a href="qml-component.html">Component</a> element provides an <i>attached</i> <tt>onCompleted</tt> property that can be used to trigger the execution of script code at startup after the QML environment has been completely established. For example:</p>
<pre class="highlightedCode brush: cpp"> Rectangle {
     function startupFunction() {
         <span class="comment">// ... startup code</span>
     }

     Component.onCompleted: startupFunction();
 }</pre>
<p>Any element in a QML file - including nested elements and nested QML component instances - can use this attached property. If there is more than one <tt>onCompleted()</tt> handler to execute at startup, they are run sequentially in an undefined order.</p>
<p>Likewise, the <a href="qml-component.html#onDestruction-signal">Component::onDestruction</a> attached property is triggered on component destruction.</p>
<a name="property-assignment-vs-property-binding"></a>
<h2>Property Assignment vs Property Binding</h2>
<p>When working with both QML and <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a>, it is important to differentiate between QML <a href="propertybinding.html">Property Binding</a> and <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> value assignment. In QML, a property binding is created using the <i>property: value</i> syntax:</p>
<pre class="highlightedCode brush: cpp"> Rectangle {
     width: otherItem.width
 }</pre>
<p>The <tt>width</tt> of the above <a href="qml-rectangle.html">Rectangle</a> is updated whenever <tt>otherItem.width</tt> changes. On the other hand, take the following <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code snippet, that runs when the <a href="qml-rectangle.html">Rectangle</a> is created:</p>
<pre class="highlightedCode brush: cpp"> Rectangle {

     Component.onCompleted: {
         width = otherItem.width;
     }
 }</pre>
<p>The <tt>width</tt> of this <a href="qml-rectangle.html">Rectangle</a> is <i>assigned</i> the value of <tt>otherItem.width</tt> using the <i>property = value</i> syntax in <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a>. Unlike the QML <i>property: value</i> syntax, this does not invoke QML property binding; the <tt>rectangle.width</tt> property is set to the value of <tt>otherItem.width</tt> at the time of the assignment and will not be updated if that value changes.</p>
<p>See <a href="propertybinding.html">Property Binding</a> for more information.</p>
<a name="qml-javascript-restrictions"></a>
<h2>QML JavaScript Restrictions</h2>
<p>QML executes standard <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code, with the following restrictions:</p>
<ul>
<li><a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code cannot modify the global object.<p>In QML, the global object is constant - existing properties cannot be modified or deleted, and no new properties may be created.</p>
<p>Most <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> programs do not intentionally modify the global object. However, <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a>'s automatic creation of undeclared variables is an implicit modification of the global object, and is prohibited in QML.</p>
<p>Assuming that the <tt>a</tt> variable does not exist in the scope chain, the following code is illegal in QML.</p>
<pre class="highlightedCode brush: cpp"> // Illegal modification of undeclared variable
 a = 1;
 for (var ii = 1; ii &lt; 10; ++ii)
     a = a * ii;
 console.log(&quot;Result: &quot; + a);</pre>
<p>It can be trivially modified to this legal code.</p>
<pre class="highlightedCode brush: cpp"> var a = 1;
 for (var ii = 1; ii &lt; 10; ++ii)
     a = a * ii;
 console.log(&quot;Result: &quot; + a);</pre>
<p>Any attempt to modify the global object - either implicitly or explicitly - will cause an exception. If uncaught, this will result in an warning being printed, that includes the file and line number of the offending code.</p>
</li>
<li>Global code is run in a reduced scope<p>During startup, if a QML file includes an external <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> file with &quot;global&quot; code, it is executed in a scope that contains only the external file itself and the global object. That is, it will not have access to the QML objects and properties it <a href="qdeclarativescope.html">normally would</a>.</p>
<p>Global code that only accesses script local variable is permitted. This is an example of valid global code.</p>
<pre class="highlightedCode brush: cpp"> var colors = [ &quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;orange&quot;, &quot;purple&quot; ];</pre>
<p>Global code that accesses QML objects will not run correctly.</p>
<pre class="highlightedCode brush: cpp"> // Invalid global code - the &quot;rootObject&quot; variable is undefined
 var initialPosition = { rootObject.x, rootObject.y }</pre>
<p>This restriction exists as the QML environment is not yet fully established. To run code after the environment setup has completed, refer to <a href="#running-javascript-at-startup">Running JavaScript at Startup</a>.</p>
</li>
<li>The value of <tt>this</tt> is currently undefined in QML<p>The value of <tt>this</tt> is undefined in QML. To refer to any element, provide an <tt>id</tt>. For example:</p>
<pre class="highlightedCode brush: cpp"> Item {
     width: 200; height: 100
     function mouseAreaClicked(area) {
         console.log(&quot;Clicked in area at: &quot; + area.x + &quot;, &quot; + area.y);
     }
     <span class="comment">// This will not work because this is undefined</span>
     MouseArea {
         height: 50; width: 200
         onClicked: mouseAreaClicked(this)
     }
     <span class="comment">// This will pass area2 to the function</span>
     MouseArea {
         id: area2
         y: 50; height: 50; width: 200
         onClicked: mouseAreaClicked(area2)
     }
 }</pre>
</li>
</ul>
</div>
<!-- @@@qdeclarativejavascript.html -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
