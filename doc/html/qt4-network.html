<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- qt4-network.qdoc -->
  <title>Qt 4.7: The Network Module in Qt 4</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global Declarations</a></li> 
			   <li><a href="licensing.html">Licenses and Credits</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global Declarations</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
			   <li class="defaultLink"><a href="qt-basic-concepts.html">Programming with Qt</a></li> 
			   <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li class="defaultLink"><a href="qt-gui-concepts.html">UI Design with Qt</a></li> 
			   <li class="defaultLink"><a href="developing-with-qt.html">Cross-platform and Platform-specific</a></li> 
			   <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li class="defaultLink"><a href="technology-apis.html">Qt and Key Technologies</a></li> 
			   <li class="defaultLink"><a href="best-practices.html">How-To's and Best Practices</a></li> 
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li>The Network Module in Qt 4</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
        </div>
        </div>
        <div class="content">
  <link rel="prev" href="qt4-sql.html" />
  <link rel="next" href="qt4-styles.html" />
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#general-overview">General Overview</a></li>
<li class="level1"><a href="#example-code">Example Code</a></li>
<li class="level2"><a href="#tcp-client">TCP Client</a></li>
<li class="level2"><a href="#tcp-server">TCP Server</a></li>
<li class="level2"><a href="#udp-senders-and-receivers">UDP Senders and Receivers</a></li>
<li class="level1"><a href="#comparison-with-qt-3">Comparison with Qt 3</a></li>
</ul>
</div>
<h1 class="title">The Network Module in Qt 4</h1>
<span class="subtitle"></span>
<!-- $$$qt4-network.html-description -->
<div class="descr"> <a name="details"></a>
<p>The network module in Qt 4 provides some new features, such as support for internationalized domain names, better IPv6 support, and better performance. And since Qt 4 allows us to break binary compatibility with previous releases, we took this opportunity to improve the class names and API to make them more intuitive to use.</p>
<a name="general-overview"></a>
<h2>General Overview</h2>
<p>Compared to Qt 3, the network module in Qt 4 brings the following benefits:</p>
<ul>
<li>The Qt 4 network classes have more intuitive names and APIs. For example, <a href="porting4.html#qserversocket">QServerSocket</a> has been renamed <a href="qtcpserver.html">QTcpServer</a>.</li>
<li>The entire network module is <a href="threads-reentrancy.html#reentrant">reentrant</a>, making it possible to use them simultaneously from multiple threads.</li>
<li>It is now possible to send and receive UDP datagrams and to use synchronous (i.e&#x2e;, blocking) sockets without having to use a low-level API (<a href="porting4.html#qsocketdevice">QSocketDevice</a> in Qt 3).</li>
<li><a href="qhostaddress.html">QHostAddress</a> and <a href="qhostinfo.html">QHostInfo</a> support internationalized domain names (RFC 3492).</li>
<li><a href="qurl.html">QUrl</a> is more lightweight and fully supports the latest URI specification draft.</li>
<li>UDP broadcasting is now supported.</li>
</ul>
<p>The Qt 4 network module provides fundamental classes for writing TCP and UDP applications, as well as higher-level classes that implement the client side of the HTTP and FTP protocols.</p>
<p>Here's an overview of the TCP and UDP classes:</p>
<ul>
<li><a href="qtcpsocket.html">QTcpSocket</a> encapsulates a TCP socket. It inherits from <a href="qiodevice.html">QIODevice</a>, so you can use <a href="qtextstream.html">QTextStream</a> and <a href="qdatastream.html">QDataStream</a> to read or write data. It is useful for writing both clients and servers.</li>
<li><a href="qtcpserver.html">QTcpServer</a> allows you to listen on a certain port on a server. It emits a <a href="qtcpserver.html#newConnection">newConnection()</a> signal every time a client tries to connect to the server. Once the connection is established, you can talk to the client using <a href="qtcpsocket.html">QTcpSocket</a>.</li>
<li><a href="qudpsocket.html">QUdpSocket</a> is an API for sending and receiving UDP datagrams.</li>
</ul>
<p><a href="qtcpsocket.html">QTcpSocket</a> and <a href="qudpsocket.html">QUdpSocket</a> inherit most of their functionality from <a href="qabstractsocket.html">QAbstractSocket</a>. You can also use <a href="qabstractsocket.html">QAbstractSocket</a> directly as a wrapper around a native socket descriptor.</p>
<p>By default, the socket classes work asynchronously (i.e&#x2e;, they are non-blocking), emitting signals to notify when data has arrived or when the peer has closed the connection. In multithreaded applications and in non-GUI applications, you also have the opportunity of using blocking (synchronous) functions on the socket, which often results in a more straightforward style of programming, with the networking logic concentrated in one or two functions instead of spread across multiple slots.</p>
<p><a href="qftp.html">QFtp</a> and <a href="qnetworkaccessmanager.html">QNetworkAccessManager</a> and its associated classes use <a href="qtcpsocket.html">QTcpSocket</a> internally to implement the FTP and HTTP protocols. The classes work asynchronously and can schedule (i.e&#x2e;, queue) requests.</p>
<p>The network module contains four helper classes: <a href="qhostaddress.html">QHostAddress</a>, <a href="qhostinfo.html">QHostInfo</a>, <a href="qurl.html">QUrl</a>, and <a href="qurlinfo.html">QUrlInfo</a>. <a href="qhostaddress.html">QHostAddress</a> stores an IPv4 or IPv6 address, <a href="qhostinfo.html">QHostInfo</a> resolves host names into addresses, <a href="qurl.html">QUrl</a> stores a URL, and <a href="qurlinfo.html">QUrlInfo</a> stores information about a resource pointed to by a URL, such as the file size and modification date. (Because <a href="qurl.html">QUrl</a> is used by <a href="qtextbrowser.html">QTextBrowser</a>, it is part of the <a href="qtcore.html">QtCore</a> library and not of <a href="qtnetwork.html">QtNetwork</a>.)</p>
<p>See the <a href="qtnetwork.html">QtNetwork</a> module overview for more information.</p>
<a name="example-code"></a>
<h2>Example Code</h2>
<p>All the code snippets presented here are quoted from self-contained, compilable examples located in Qt's <tt>examples/network</tt> directory.</p>
<a name="tcp-client"></a>
<h3>TCP Client</h3>
<p>The first example illustrates how to write a TCP client using <a href="qtcpsocket.html">QTcpSocket</a>. The client talks to a fortune server that provides fortune to the user. Here's how to set up the socket:</p>
<pre class="highlightedCode brush: cpp">     tcpSocket = new QTcpSocket(this);

     connect(tcpSocket, SIGNAL(readyRead()), this, SLOT(readFortune()));
     connect(tcpSocket, SIGNAL(error(QAbstractSocket::SocketError)),
             this, SLOT(displayError(QAbstractSocket::SocketError)));</pre>
<p>When the user requests a new fortune, the client establishes a connection to the server:</p>
<pre class="highlightedCode brush: cpp">     tcpSocket-&gt;connectToHost(hostLineEdit-&gt;text(),
                              portLineEdit-&gt;text().toInt());</pre>
<p>When the server answers, the following code is executed to read the data from the socket:</p>
<pre class="highlightedCode brush: cpp">     QDataStream in(tcpSocket);
     in.setVersion(QDataStream::Qt_4_0);

     if (blockSize == 0) {
         if (tcpSocket-&gt;bytesAvailable() &lt; (int)sizeof(quint16))
             return;

         in &gt;&gt; blockSize;
     }

     if (tcpSocket-&gt;bytesAvailable() &lt; blockSize)
         return;

     QString nextFortune;
     in &gt;&gt; nextFortune;

     if (nextFortune == currentFortune) {
         QTimer::singleShot(0, this, SLOT(requestNewFortune()));
         return;
     }

     currentFortune = nextFortune;</pre>
<p>The server's answer starts with a <i>size</i> field (which we store in <tt>blockSize</tt>), followed by <i>size</i> bytes of data. If the client hasn't received all the data yet, it waits for the server to send more.</p>
<p>An alternative approach is to use a blocking socket. The code can then be concentrated in one function:</p>
<pre class="highlightedCode brush: cpp">         const int Timeout = 5 * 1000;

         QTcpSocket socket;
         socket.connectToHost(serverName, serverPort);

         if (!socket.waitForConnected(Timeout)) {
             emit error(socket.error(), socket.errorString());
             return;
         }

         while (socket.bytesAvailable() &lt; (int)sizeof(quint16)) {
             if (!socket.waitForReadyRead(Timeout)) {
                 emit error(socket.error(), socket.errorString());
                 return;
             }
         }

         quint16 blockSize;
         QDataStream in(&amp;socket);
         in.setVersion(QDataStream::Qt_4_0);
         in &gt;&gt; blockSize;

         while (socket.bytesAvailable() &lt; blockSize) {
             if (!socket.waitForReadyRead(Timeout)) {
                 emit error(socket.error(), socket.errorString());
                 return;
             }
         }

         mutex.lock();
         QString fortune;
         in &gt;&gt; fortune;
         emit newFortune(fortune);</pre>
<a name="tcp-server"></a>
<h3>TCP Server</h3>
<p>The following code snippets illustrate how to write a TCP server using <a href="qtcpserver.html">QTcpServer</a> and <a href="qtcpsocket.html">QTcpSocket</a>. Here's how to set up a TCP server:</p>
<pre class="highlightedCode brush: cpp">     tcpServer = new QTcpServer(this);
     if (!tcpServer-&gt;listen()) {
         QMessageBox::critical(this, tr(&quot;Fortune Server&quot;),
                               tr(&quot;Unable to start the server: %1.&quot;)
                               .arg(tcpServer-&gt;errorString()));
         close();
         return;
     }

         connect(tcpServer, SIGNAL(newConnection()), this, SLOT(sendFortune()));</pre>
<p>When a client tries to connect to the server, the following code in the sendFortune() slot is executed:</p>
<pre class="highlightedCode brush: cpp">     QByteArray block;
     QDataStream out(&amp;block, QIODevice::WriteOnly);
     out.setVersion(QDataStream::Qt_4_0);
     out &lt;&lt; (quint16)0;
     out &lt;&lt; fortunes.at(qrand() % fortunes.size());
     out.device()-&gt;seek(0);
     out &lt;&lt; (quint16)(block.size() - sizeof(quint16));

     QTcpSocket *clientConnection = tcpServer-&gt;nextPendingConnection();
     connect(clientConnection, SIGNAL(disconnected()),
             clientConnection, SLOT(deleteLater()));

     clientConnection-&gt;write(block);
     clientConnection-&gt;disconnectFromHost();</pre>
<a name="udp-senders-and-receivers"></a>
<h3>UDP Senders and Receivers</h3>
<p>Here's how to broadcast a UDP datagram:</p>
<pre class="highlightedCode brush: cpp">     udpSocket = new QUdpSocket(this);
     QByteArray datagram = &quot;Broadcast message &quot; + QByteArray::number(messageNo);
     udpSocket-&gt;writeDatagram(datagram.data(), datagram.size(),
                              QHostAddress::Broadcast, 45454);</pre>
<p>Here's how to receive a UDP datagram:</p>
<pre class="highlightedCode brush: cpp">     udpSocket = new QUdpSocket(this);
     udpSocket-&gt;bind(45454, QUdpSocket::ShareAddress);

     connect(udpSocket, SIGNAL(readyRead()),
             this, SLOT(processPendingDatagrams()));</pre>
<p>Then in the processPendingDatagrams() slot:</p>
<pre class="highlightedCode brush: cpp">     while (udpSocket-&gt;hasPendingDatagrams()) {
         QByteArray datagram;
         datagram.resize(udpSocket-&gt;pendingDatagramSize());
         udpSocket-&gt;readDatagram(datagram.data(), datagram.size());
         statusLabel-&gt;setText(tr(&quot;Received datagram: \&quot;%1\&quot;&quot;)
                              .arg(datagram.data()));
     }</pre>
<a name="comparison-with-qt-3"></a>
<h2>Comparison with Qt 3</h2>
<p>The main difference between Qt 3 and Qt 4 is that the very high level <a href="porting4.html#qnetworkprotocol">QNetworkProtocol</a> and <a href="porting4.html#qurloperator">QUrlOperator</a> abstraction has been eliminated. These classes attempted the impossible (unify FTP and HTTP under one roof), and unsurprisingly failed at that. Qt 4 still provides <a href="qftp.html">QFtp</a>, and it also provides the <a href="qnetworkaccessmanager.html">QNetworkAccessManager</a>.</p>
<p>The <a href="porting4.html#qsocket">QSocket</a> class in Qt 3 has been renamed <a href="qtcpsocket.html">QTcpSocket</a>. The new class is reentrant and supports blocking. It's also easier to handle closing than with Qt 3, where you had to connect to both the QSocket::connectionClosed() and the QSocket::delayedCloseFinished() signals.</p>
<p>The <a href="porting4.html#qserversocket">QServerSocket</a> class in Qt 3 has been renamed <a href="qtcpserver.html">QTcpServer</a>. The API has changed quite a bit. While in Qt 3 it was necessary to subclass <a href="porting4.html#qserversocket">QServerSocket</a> and reimplement the newConnection() pure virtual function, <a href="qtcpserver.html">QTcpServer</a> now emits a <a href="qtcpserver.html#newConnection">newConnection()</a> signal that you can connect to a slot.</p>
<p>The <a href="qhostinfo.html">QHostInfo</a> class has been redesigned to use the operating system's getaddrinfo() function instead of implementing the DNS protocol. Internally, <a href="qhostinfo.html">QHostInfo</a> simply starts a thread and calls getaddrinfo() in that thread. This wasn't possible in Qt 3 because getaddrinfo() is a blocking call and Qt 3 could be configured without multithreading support.</p>
<p>The <a href="porting4.html#qsocketdevice">QSocketDevice</a> class in Qt 3 is no longer part of the public Qt API. If you used <a href="porting4.html#qsocketdevice">QSocketDevice</a> to send or receive UDP datagrams, use <a href="qudpsocket.html">QUdpSocket</a> instead. If you used <a href="porting4.html#qsocketdevice">QSocketDevice</a> because it supported blocking sockets, use <a href="qtcpsocket.html">QTcpSocket</a> or <a href="qudpsocket.html">QUdpSocket</a> instead and use the blocking functions (<a href="qabstractsocket.html#waitForConnected">waitForConnected()</a>, <a href="qabstractsocket.html#waitForConnected">waitForReadyRead()</a>, etc.)&#x2e; If you used <a href="porting4.html#qsocketdevice">QSocketDevice</a> from a non-GUI thread because it was the only reentrant networking class in Qt 3, use <a href="qtcpsocket.html">QTcpSocket</a>, <a href="qtcpserver.html">QTcpServer</a>, or <a href="qudpsocket.html">QUdpSocket</a> instead.</p>
<p>Internally, Qt 4 has a class called QSocketLayer that provides a cross-platform low-level socket API. It resembles the old <a href="porting4.html#qsocketdevice">QSocketDevice</a> class. We might make it public in a later release if users ask for it.</p>
<p>As an aid to porting to Qt 4, the <a href="qt3support.html">Qt3Support</a> library includes <a href="q3dns.html" class="compat">Q3Dns</a>, <a href="q3serversocket.html" class="compat">Q3ServerSocket</a>, <a href="q3socket.html" class="compat">Q3Socket</a>, and <a href="q3socketdevice.html" class="compat">Q3SocketDevice</a> classes.</p>
</div>
<!-- @@@qt4-network.html -->
<p>
[Previous: <a href="qt4-sql.html">The Qt 4 Database GUI Layer</a>]
[Next: <a href="qt4-styles.html">The Qt 4 Style API</a>]
</p>
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    </div> 
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
    <br />
    <p>
      Licensees holding valid Qt Commercial licenses may use this document in accordance with the      Qt Commercial License Agreement provided with the Software or, alternatively, in accordance      with the terms contained in a written agreement between you and Nokia.</p>
    <p>
      Alternatively, this document may be used under the terms of the <a href="http://www.gnu.org/licenses/fdl.html">GNU
      Free Documentation License version 1.3</a>
      as published by the Free Software Foundation.</p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <p class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
</body>
</html>
